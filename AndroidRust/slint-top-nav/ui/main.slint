import { Button, TextEdit, VerticalBox, HorizontalBox } from "std-widgets.slint";

export struct MenuItem {
    name: string,
    icon: string
}

export global AppLogic {
    in-out property <[MenuItem]> menu_items;
    in-out property <int> current_menu: 0;
    in-out property <string> popup_message;
    in-out property <bool> popup_visible: false;
    
    callback submit(string, string, string);
    callback menu_selected(int);
    callback close_popup();
}

export global Theme {
    in-out property <color> primary_color: #6200EE;
    in-out property <color> accent_color: #03DAC6;
    in-out property <color> background_color: #121212;
}

export global Strings {
    in-out property <string> app_name: "Slint Top Nav";
    in-out property <string> submit_button: "Submit";
}

export component AppWindow inherits Window {
    title: Strings.app_name;
    background: Theme.background_color;
    
    VerticalBox {
        padding: 10px;
        
        // Top Navigation Bar
        HorizontalBox {
            for item[index] in AppLogic.menu_items : Rectangle {
                width: 60px;
                height: 60px;
                background: AppLogic.current_menu == index ? Theme.accent_color : transparent;
                
                if item.name == "Home": Image {
                    source: @image-url("icons/home.svg");
                    width: 24px;
                    height: 24px;
                }
                if item.name == "Profile": Image {
                    source: @image-url("icons/profile.svg");
                    width: 24px;
                    height: 24px;
                }
                if item.name == "Settings": Image {
                    source: @image-url("icons/settings.svg");
                    width: 24px;
                    height: 24px;
                }
                
                TouchArea {
                    clicked => { AppLogic.menu_selected(index); }
                }
            }
        }
        
        // Content Area
        VerticalBox {
            padding: 20px;
            spacing: 10px;
            
            Text {
                text: AppLogic.menu_items[AppLogic.current_menu].name;
                color: #FFFFFF;
                font-size: 24px;
                font-weight: 600;
            }
            
            input1 := TextEdit {
                text: "";
                width: 100%;
                height: 40px;
                font-size: 16px;
            }
            
            input2 := TextEdit {
                text: "";
                width: 100%;
                height: 40px;
                font-size: 16px;
            }
            
            Button {
                text: Strings.submit_button;
                width: 100px;
                height: 40px;
                
                clicked => {
                    AppLogic.submit(
                        AppLogic.menu_items[AppLogic.current_menu].name,
                        input1.text,
                        input2.text
                    );
                }
            }
        }
        
        // Popup Dialog
        if AppLogic.popup_visible : Rectangle {
            // Outer rectangle is transparent and centers the popup
            background: transparent;
            // Use layout to center the inner Rectangle
            HorizontalBox {
                alignment: center;
                VerticalBox {
                    alignment: center;
                    Rectangle {
                        background: Theme.primary_color;
                        width: 200px;
                        height: 100px;
                        
                        VerticalBox {
                            Text {
                                text: AppLogic.popup_message;
                                color: #FFFFFF;
                                font-size: 16px;
                            }
                            
                            Button {
                                text: "OK";
                                width: 80px;
                                height: 40px;
                                
                                clicked => { AppLogic.close_popup(); }
                            }
                        }
                    }
                }
            }
        }
    }
}